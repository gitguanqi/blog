(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{490:function(s,a,t){"use strict";t.r(a);var e=t(10),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("之前说的是本地代理设置，现在记录一下远程代理服务器squid的使用方法。")])]),s._v(" "),t("h2",{attrs:{id:"squid简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#squid简介"}},[s._v("#")]),s._v(" squid简介")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.squid-cache.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("squid官网"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("据官网介绍，Squid是Web的缓存代理，支持HTTP，HTTPS，FTP等。通过缓存和重用经常请求的网页，它减少了带宽并缩短了响应时间。Squid具有广泛的访问控制，是一个出色的服务器加速器。它可以在大多数可用的操作系统（包括Windows）上运行，并已获得GNU GPL的许可。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/squid.jpg",alt:"squid原理"}})]),s._v(" "),t("p",[t("strong",[s._v("资源网址：")])]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"http://www.squid-cache.org/Doc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("squid-cache"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/bluestorm/p/9032086.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bluestorm's Space"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"squid作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#squid作用"}},[s._v("#")]),s._v(" squid作用")]),s._v(" "),t("ul",[t("li",[s._v("缓存经常请求使用的网页")]),s._v(" "),t("li",[s._v("减少带宽缩小响应时间")]),s._v(" "),t("li",[s._v("加速网页访问")]),s._v(" "),t("li",[s._v("对访问内容进行过滤控制")]),s._v(" "),t("li",[s._v("共享网络连接，节省ip开销")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/squid-tcp.jpg",alt:"squid在TCP/IP"}})]),s._v(" "),t("h2",{attrs:{id:"安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置"}},[s._v("#")]),s._v(" 安装配置")]),s._v(" "),t("p",[s._v("安装前准备工作：")]),s._v(" "),t("ul",[t("li",[s._v("一台远程Linux服务器")]),s._v(" "),t("li",[s._v("一台具有上网功能的本地计算机")])]),s._v(" "),t("h3",{attrs:{id:"安装squid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装squid"}},[s._v("#")]),s._v(" 安装squid")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" squid httpd-tools -y\n")])])]),t("h3",{attrs:{id:"配置squid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置squid"}},[s._v("#")]),s._v(" 配置squid")]),s._v(" "),t("p",[s._v("打开"),t("code",[s._v("/etc/squid/squid.conf")])]),s._v(" "),t("p",[t("strong",[s._v("配置文件全部内容：")])]),s._v(" "),t("div",{staticClass:"language-config extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#\n# Recommended minimum configuration:\n#\n\n# Example rule allowing access from your local networks.\n# Adapt to list your (internal) IP networks from where browsing\n# should be allowed\nacl localnet src 10.0.0.0/8     # RFC1918 possible internal network\nacl localnet src 172.16.0.0/12  # RFC1918 possible internal network\nacl localnet src 192.168.0.0/16 # RFC1918 possible internal network\nacl localnet src fc00::/7       # RFC 4193 local private network range\nacl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines\n\nacl SSL_ports port 443\nacl Safe_ports port 80          # http\nacl Safe_ports port 21          # ftp\nacl Safe_ports port 443         # https\nacl Safe_ports port 70          # gopher\nacl Safe_ports port 210         # wais\nacl Safe_ports port 1025-65535  # unregistered ports\nacl Safe_ports port 280         # http-mgmt\nacl Safe_ports port 488         # gss-http\nacl Safe_ports port 591         # filemaker\nacl Safe_ports port 777         # multiling http\nacl CONNECT method CONNECT\n\n#\n# Recommended minimum Access Permission configuration:\n#\n# Deny requests to certain unsafe ports\nhttp_access deny !Safe_ports\n\n# Deny CONNECT to other than secure SSL ports\nhttp_access deny CONNECT !SSL_ports\n\n# Only allow cachemgr access from localhost\nhttp_access allow localhost manager\nhttp_access deny manager\n\n# We strongly recommend the following be uncommented to protect innocent\n# web applications running on the proxy server who think the only\n# one who can access services on "localhost" is a local user\n#http_access deny to_localhost\n\n#\n# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS\n#\n\n# Example rule allowing access from your local networks.\n# Adapt localnet in the ACL section to list your (internal) IP networks\n# from where browsing should be allowed\nhttp_access allow localnet\nhttp_access allow localhost\n\n# And finally deny all other access to this proxy\nhttp_access deny all\n\n# Squid normally listens to port 3128\nhttp_port 3128\n\n# Uncomment and adjust the following to add a disk cache directory.\n#cache_dir ufs /var/spool/squid 100 16 256\n\n# Leave coredumps in the first cache dir\ncoredump_dir /var/spool/squid\n\n#\n# Add any of your own refresh_pattern entries above these.\n#\nrefresh_pattern ^ftp:           1440    20%     10080\nrefresh_pattern ^gopher:        1440    0%      1440\nrefresh_pattern -i (/cgi-bin/|\\?) 0     0%      0\nrefresh_pattern .               0       20%     4320\n')])])]),t("p",[s._v("修改以下信息")]),s._v(" "),t("div",{staticClass:"language-config extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 监听端口号\nhttp_port 3128\n\n# 这样写会同时监听ipv6和ipv4的端口\n#  http_port 0.0.0.0:3128\n\n# 添加到末尾\n# 内存中的缓存大小\ncache_mem 128 MB\n\n# 最大缓存文件大小\nmaximum_object_size 16 MB\n\n# 限定下载文件大小\nreply_body_max_size  1024000 allow all\n\n# 缓存文件夹，默认在内存中，指定缓存大小为100M，第一层子目录为16个，第二层为256\ncache_dir ufs /var/spool/squid 100 16 256\n\n# 定义访问日志路径\naccess_log /var/log/squid/access.log\n\n# 定义管理员邮箱\ncache_mgr jcguanqi@126.com\n")])])]),t("p",[s._v("**是否认证访问：**如果使用访问认证，会更安全。")]),s._v(" "),t("h3",{attrs:{id:"访问认证配置方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#访问认证配置方法"}},[s._v("#")]),s._v(" 访问认证配置方法")]),s._v(" "),t("ul",[t("li",[s._v("生成密码文件")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("htpasswd -c /etc/squid/passwd "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 回车后输入密码，不要超过8位")]),s._v("\n")])])]),t("ul",[t("li",[s._v("测试是否生效")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入用户名和密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果ok说明成功")]),s._v("\nOK\n")])])]),t("ul",[t("li",[s._v("加入配置文件")])]),s._v(" "),t("div",{staticClass:"language-config extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 注释以下内容：\n# http_access deny !Safe_ports\n# http_access deny CONNECT !SSL_ports\n# http_access deny to_localhost\n# http_access allow localnet\n# http_access deny all\n\n# 定义每个IP最大允许16个连接，防止攻击\nacl OverConnLimit maxconn 16\n\nauth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/passwd\n\n# 认证程序的进程数\nauth_param basic children 6\n\n# 客户端提示\nauth_param basic realm test Squid Server\n\n# 有效时间\nauth_param basic credentialsttl 1 hours\n\n# 认证用户\nacl auth_user proxy_auth REQUIRED\n\n# 超出之前设定的连接数则拒绝\nhttp_access deny OverConnLimit\n\n# 允许的访问\nhttp_access allow auth_user\n\n# 拒绝其它所有访问\nhttp_access deny all\n")])])]),t("p",[s._v("如果不使用访问认证，就在配置文件末尾加入"),t("code",[s._v("http_access allow all")])]),s._v(" "),t("h2",{attrs:{id:"常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),t("h3",{attrs:{id:"初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[s._v("#")]),s._v(" 初始化")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("squid -z\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R squid:squid/cache\n")])])]),t("h3",{attrs:{id:"验证语法配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证语法配置"}},[s._v("#")]),s._v(" 验证语法配置")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("squid -k parse\n")])])]),t("h3",{attrs:{id:"启动并输出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动并输出"}},[s._v("#")]),s._v(" 启动并输出")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/usr/local/squid/sbin/squid -N -d1\n")])])]),t("h3",{attrs:{id:"查看进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看进程"}},[s._v("#")]),s._v(" 查看进程")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ax "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" squid\n")])])]),t("h3",{attrs:{id:"停止服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止服务"}},[s._v("#")]),s._v(" 停止服务")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("squid -k "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),t("h2",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("h3",{attrs:{id:"初始化服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化服务"}},[s._v("#")]),s._v(" 初始化服务")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./squid -z\n")])])]),t("h3",{attrs:{id:"开启防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启防火墙"}},[s._v("#")]),s._v(" 开启防火墙")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("firewall-cmd --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3128")]),s._v("/tcp --permanent\nfirewall-cmd --reload\n")])])]),t("h3",{attrs:{id:"开启服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启服务"}},[s._v("#")]),s._v(" 开启服务")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" squid\nsystemctl start squid\nsystemctl status squid\n")])])]),t("h3",{attrs:{id:"查看端口状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看端口状态"}},[s._v("#")]),s._v(" 查看端口状态")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnl\n")])])]),t("p",[t("img",{attrs:{src:"/img/squid-port.jpg",alt:"squid port"}})]),s._v(" "),t("h2",{attrs:{id:"本地设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地设置"}},[s._v("#")]),s._v(" 本地设置")]),s._v(" "),t("p",[s._v("打开本地游览器，进入代理设置，然后保存。")]),s._v(" "),t("p",[s._v("随便打开一个网站，F12检查查看网络请求情况。")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/squid-eg.jpg",alt:"案例：百度"}})]),s._v(" "),t("h2",{attrs:{id:"写在最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[s._v("#")]),s._v(" 写在最后")]),s._v(" "),t("p",[s._v("squid功能还有很大，这里只是介绍一种功能。")])])}),[],!1,null,null,null);a.default=n.exports}}]);