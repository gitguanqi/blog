(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{497:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("前两天我学习了一下docker的一些基本知识点，这里用的centos7，现在做一个总结。")])]),s._v(" "),t("h2",{attrs:{id:"目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),t("ul",[t("li",[s._v("安装docker")]),s._v(" "),t("li",[s._v("拉取镜像")]),s._v(" "),t("li",[s._v("运行nginx")]),s._v(" "),t("li",[s._v("运行php")]),s._v(" "),t("li",[s._v("nginx配置php")]),s._v(" "),t("li",[s._v("运行mysql")]),s._v(" "),t("li",[s._v("配置phpmyadmin")])]),s._v(" "),t("h2",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("ul",[t("li",[s._v("下载docker(yum自带版本低)")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker\n")])])]),t("ul",[t("li",[s._v("下载docker-ce")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/redhat-release\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum-config-manager --enable docker-ce-edge "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选")]),s._v("\nyum-config-manager --enable docker-ce-test "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n")])])]),t("ul",[t("li",[s._v("启动运行docker")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start docker\n")])])]),t("ul",[t("li",[s._v("配置国内镜像")])]),s._v(" "),t("p",[s._v("进入daemon.json写入以下内容。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/docker/daemon.json\n")])])]),t("p",[s._v("写入以下内容")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("ul",[t("li",[s._v("添加当前用户到docker组")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),t("ul",[t("li",[s._v("重启docker")])]),s._v(" "),t("p",[t("code",[s._v("systemctl restart docker")])]),s._v(" "),t("ul",[t("li",[s._v("docker常用命令")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像操作")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取镜像")]),s._v("\ndocker pull 镜像名称:镜像版本号\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像")]),s._v("\ndocker images\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除镜像")]),s._v("\ndocker rmi 镜像名称/镜像id\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器操作")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建容器")]),s._v("\ndocker run --name 容器名称 -p 外部端口号:容器端口号 -e 容器环境参数 -v 映射外部文件到镜像内部 -d 镜像名称\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看活动容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\ndocker start 容器名称/容器id\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止容器")]),s._v("\ndocker stop 容器名称/容器id\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启容器")]),s._v("\ndocker restart 容器名称/容器id\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 容器名称/容器id\n")])])]),t("h2",{attrs:{id:"拉取镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[s._v("#")]),s._v(" 拉取镜像")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx")]),s._v("\ndocker pull nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# php")]),s._v("\ndocker pull php:7.1-fpm\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql")]),s._v("\ndocker pull mysql:8.0.18\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node")]),s._v("\ndocker pull node:10.18.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# phpmyadmin")]),s._v("\ndocker pull phpmyadmin/phpmyadmin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# centos7")]),s._v("\ndocker pull centos:centos7\n")])])]),t("h2",{attrs:{id:"运行nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行nginx"}},[s._v("#")]),s._v(" 运行nginx")]),s._v(" "),t("p",[t("code",[s._v("docker run --name nginx-test -p 8080:80 -d nginx")])]),s._v(" "),t("p",[s._v("打开"),t("code",[s._v("ip:8080")]),s._v("就可以访问了。")]),s._v(" "),t("h2",{attrs:{id:"运行php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行php"}},[s._v("#")]),s._v(" 运行php")]),s._v(" "),t("p",[t("code",[s._v("docker run --name php-test -v /usr/local/web:/www -d php:7.1-fpm")])]),s._v(" "),t("p",[s._v("-v就是本地的文件映射到容器内的文件")]),s._v(" "),t("h2",{attrs:{id:"nginx配置php"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置php"}},[s._v("#")]),s._v(" nginx配置php")]),s._v(" "),t("ul",[t("li",[s._v("主机新建web用于存放php文件；创建nginx用于存放nginx配置文件。")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/web\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/src/nginx\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/nginx\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" conf.d logs html\n")])])]),t("ul",[t("li",[s._v("在web文件夹中写入一个文件")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/local/web/index.php\n")])])]),t("p",[s._v("写入")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("phpinfo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("?>")])]),s._v("\n")])])]),t("ul",[t("li",[s._v("写入nginx配置文件")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/nginx/conf.d\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" php-test.conf\n")])])]),t("div",{staticClass:"language-config extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server {\n    listen       80;\n    server_name  localhost;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm index.php;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass   php:9000;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  /www/$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}\n")])])]),t("ul",[t("li",[s._v("运行配置")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run --name php-demo -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),s._v(":80 -d -v /usr/local/web:/usr/share/nginx/html:ro -v /usr/local/src/nginx/conf.d:/etc/nginx/conf.d:ro --link php-test:php nginx\n")])])]),t("p",[s._v("打开"),t("code",[s._v("ip:8082")]),s._v("就可以访问了。")]),s._v(" "),t("h2",{attrs:{id:"运行mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行mysql"}},[s._v("#")]),s._v(" 运行mysql")]),s._v(" "),t("ul",[t("li",[s._v("运行mysql")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run -itd --name mysql-test -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306 -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MYsqldlmm20001. -d mysql:8.0.18\n")])])]),t("ul",[t("li",[s._v("创建账号和数据库")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql-test /bin/bash\nmysql -u root -p\ncreate database "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nCREATE "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT ALL PRIVILEGES ON test.* TO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nFLUSH PRIVILEGES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"配置phpmyadmin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置phpmyadmin"}},[s._v("#")]),s._v(" 配置phpmyadmin")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run -d --name phpMyAdmin -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PMA_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route show "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" docker0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PMA_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(":80 phpmyadmin/phpmyadmin\n")])])]),t("h2",{attrs:{id:"配置centos7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置centos7"}},[s._v("#")]),s._v(" 配置centos7")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run --name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("centos -itd --privileged -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20010")]),s._v(":22 centos:centos7 /usr/sbin/init\n")])])]),t("p",[s._v("注意："),t("code",[s._v("Failed to get D-Bus connection: Operation not permitted")]),s._v("，使用不了"),t("code",[s._v("systemctl")]),s._v("，systemd维护系统程序，需要特权就会访问Linux内核；容器不是一个完整的操作系统，只有一个文件系统，而且默认启动只是普通用户这样的权限访问Linux内核，所以要给特权以便容器访问系统。")])])}),[],!1,null,null,null);a.default=e.exports}}]);